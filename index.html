<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Malla Curricular - Ingeniería Pesquera</title>
  <style>
    body {
      font-family: sans-serif;
      background: #f2f2f2;
      margin: 0;
      padding: 1rem;
    }
    h1 {
      text-align: center;
    }
    .selector-carrera {
      margin: 1rem auto;
      text-align: center;
    }
    .semestre {
      margin-bottom: 2rem;
      padding: 1rem;
      border-radius: 10px;
      background: #fff;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    .semestre h2 {
      border-bottom: 1px solid #ccc;
    }
    .asignaturas {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
    }
    .asignatura {
      flex: 1 1 calc(33% - 1rem);
      padding: 1rem;
      border-radius: 10px;
      color: #fff;
      position: relative;
      cursor: pointer;
      transition: transform 0.2s;
    }
    .asignatura:hover {
      transform: scale(1.03);
    }
    .asignatura .nombre {
      font-weight: bold;
    }
    .asignatura .estrellita {
      position: absolute;
      top: -10px;
      right: -10px;
      font-size: 1.5rem;
    }
    select {
      font-size: 1rem;
      padding: 0.5rem;
    }
    .oculta {
      display: none;
    }
  </style>
</head>
<body>
  <h1>Malla Curricular de la Facultad</h1>
  <div class="selector-carrera">
    <label for="carrera">Selecciona una carrera: </label>
    <select id="carrera">
      <option value="">-- Selecciona --</option>
      <option value="pesquera">Ingeniería Pesquera</option>
    </select>
  </div>
  <div id="contenedor-malla" class="oculta"></div>

  <script>
    const mallaPesquera = [
      {
        semestre: 1,
        asignaturas: [
          {
            nombre: "Biología",
            area: "Ciencias Biológicas",
            creditos: 4,
            prerrequisito: "",
            color: "#3498db",
            aprobado: false
          },
          {
            nombre: "Matemática I",
            area: "Ciencias Básicas",
            creditos: 5,
            prerrequisito: "",
            color: "#e67e22",
            aprobado: false
          },
          {
            nombre: "Química General",
            area: "Ciencias Básicas",
            creditos: 4,
            prerrequisito: "",
            color: "#2ecc71",
            aprobado: false
          }
        ]
      },
      {
        semestre: 2,
        asignaturas: [
          {
            nombre: "Matemática II",
            area: "Ciencias Básicas",
            creditos: 5,
            prerrequisito: "Matemática I",
            color: "#1abc9c",
            aprobado: false
          },
          {
            nombre: "Biología Marina",
            area: "Ciencias Biológicas",
            creditos: 4,
            prerrequisito: "Biología",
            color: "#f39c12",
            aprobado: false
          },
          {
            nombre: "Oceanografía Pesquera",
            area: "Ciencias del Mar",
            creditos: 4,
            prerrequisito: "",
            color: "#9b59b6",
            aprobado: false
          }
        ]
      }
    ];

    const contenedor = document.getElementById("contenedor-malla");

    function renderMalla(malla) {
      contenedor.innerHTML = "";
      contenedor.classList.remove("oculta");

      const totalCreditos = 174;
      const creditosNecesarios = Math.floor(totalCreditos * 0.3); // 30%
      const creditosAprobados = malla.reduce((sum, semestre) =>
        sum + semestre.asignaturas.reduce((acum, asig) =>
          acum + (asig.aprobado ? asig.creditos : 0), 0), 0
      );

      malla.forEach((semestre) => {
        const semestreDiv = document.createElement("div");
        semestreDiv.className = "semestre";

        const titulo = document.createElement("h2");
        titulo.textContent = `Semestre ${semestre.semestre}`;
        semestreDiv.appendChild(titulo);

        const asignaturasDiv = document.createElement("div");
        asignaturasDiv.className = "asignaturas";

        semestre.asignaturas.forEach(asig => {
          let desbloqueada = true;
          let tooltip = "";

          if (asig.nombre === "Oceanografía Pesquera") {
            if (creditosAprobados < creditosNecesarios) {
              desbloqueada = false;
              tooltip = `Se requieren ${creditosNecesarios} créditos aprobados. Actualmente tienes ${creditosAprobados}.`;
            }
          } else if (asig.prerrequisito) {
            desbloqueada = malla.some(s =>
              s.asignaturas.some(a => a.nombre === asig.prerrequisito && a.aprobado)
            );
            if (!desbloqueada) {
              tooltip = `Requiere: ${asig.prerrequisito}`;
            }
          }

          const card = document.createElement("div");
          card.className = "asignatura";
          card.style.backgroundColor = desbloqueada ? asig.color : "#ccc";
          card.style.pointerEvents = desbloqueada ? "auto" : "none";
          if (tooltip) card.title = tooltip;

          const nombre = document.createElement("div");
          nombre.className = "nombre";
          nombre.textContent = asig.nombre;

          const area = document.createElement("div");
          area.textContent = asig.area;

          const creditos = document.createElement("div");
          creditos.textContent = `Créditos: ${asig.creditos}`;

          const prer = document.createElement("div");
          prer.textContent = asig.prerrequisito ? `Prerrequisito: ${asig.prerrequisito}` : "";

          if (asig.aprobado) {
            const estrella = document.createElement("div");
            estrella.className = "estrellita";
            estrella.textContent = "⭐";
            card.appendChild(estrella);
          }

          card.addEventListener("click", () => {
            if (desbloqueada && !asig.aprobado) {
              asig.aprobado = true;
              renderMalla(malla);
            }
          });

          card.appendChild(nombre);
          card.appendChild(area);
          card.appendChild(creditos);
          card.appendChild(prer);
          asignaturasDiv.appendChild(card);
        });

        semestreDiv.appendChild(asignaturasDiv);
        contenedor.appendChild(semestreDiv);
      });
    }

    document.getElementById("carrera").addEventListener("change", function () {
      const carrera = this.value;
      if (carrera === "pesquera") {
        renderMalla(mallaPesquera);
      } else {
        contenedor.innerHTML = "<p>Esta carrera aún no tiene malla disponible.</p>";
      }
    });
  </script>
</body>
</html>
